# ============================================================================
# SIEM-SOAR Platform: Redis Sentinel Configuration
# ============================================================================
# Purpose: High availability monitoring and automatic failover
# Deployment: 3 Sentinel instances for quorum
# ============================================================================

# =============================================================================
# NETWORK
# =============================================================================

# Sentinel port
port 26379

# Bind address
bind 0.0.0.0

# Protected mode
protected-mode no

# =============================================================================
# SENTINEL MONITORS
# =============================================================================

# Monitor master (name, host, port, quorum)
# Quorum = number of Sentinels that must agree for failover
sentinel monitor siem-master redis-master 6379 2

# Auth password for master (if requirepass is set)
# sentinel auth-pass siem-master your_redis_password_here

# Down after milliseconds (time without reply to consider instance down)
sentinel down-after-milliseconds siem-master 5000

# Parallel syncs (replicas to reconfigure at a time during failover)
sentinel parallel-syncs siem-master 1

# Failover timeout (milliseconds)
sentinel failover-timeout siem-master 60000

# =============================================================================
# SENTINEL ANNOUNCE
# =============================================================================

# Announce IP (for Docker/K8s environments)
# sentinel announce-ip <ip>
# sentinel announce-port <port>

# =============================================================================
# SCRIPTS
# =============================================================================

# Notification script (called on any event)
# sentinel notification-script siem-master /scripts/notify.sh

# Client reconfiguration script (called after failover)
# sentinel client-reconfig-script siem-master /scripts/reconfig.sh

# =============================================================================
# SECURITY
# =============================================================================

# Sentinel password
# requirepass your_sentinel_password_here

# ACL
# aclfile /etc/redis/sentinel-acl.conf

# =============================================================================
# LOGGING
# =============================================================================

# Log level
loglevel notice

# Log file (empty for stdout)
logfile ""

# =============================================================================
# WORKING DIRECTORY
# =============================================================================

dir /data

# =============================================================================
# ADDITIONAL SETTINGS
# =============================================================================

# Deny scripts reconfiguration (security measure)
sentinel deny-scripts-reconfig yes

# Resolve hostnames
sentinel resolve-hostnames yes
sentinel announce-hostnames yes

# =============================================================================
# NOTES FOR SIEM-SOAR DEPLOYMENT
# =============================================================================
#
# Sentinel Deployment:
# - Run 3 Sentinel instances for proper quorum (majority voting)
# - Each Sentinel should be on a different server/pod
# - Sentinels will auto-discover each other via the monitored master
#
# Failover Process:
# 1. Sentinel detects master is down (down-after-milliseconds)
# 2. Sentinel enters SDOWN state (Subjectively Down)
# 3. Multiple Sentinels confirm = ODOWN state (Objectively Down)
# 4. Sentinels elect a leader to perform failover
# 5. Leader promotes best replica to master
# 6. Other replicas reconfigure to new master
# 7. Old master (when back) becomes replica
#
# Application Configuration:
# - Use Sentinel-aware Redis clients (go-redis supports this)
# - Connect to Sentinels, not directly to Redis
# - Client will query Sentinel for current master address
#
# Example Go connection:
#   rdb := redis.NewFailoverClient(&redis.FailoverOptions{
#       MasterName:    "siem-master",
#       SentinelAddrs: []string{"sentinel-1:26379", "sentinel-2:26379", "sentinel-3:26379"},
#   })
# =============================================================================
