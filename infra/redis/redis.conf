# ============================================================================
# SIEM-SOAR Platform: Redis Configuration
# ============================================================================
# Purpose: Cache, session storage, and real-time pub/sub
# Deployment: Redis Sentinel for HA
# ============================================================================

# =============================================================================
# NETWORK
# =============================================================================

# Bind to all interfaces (use with proper network security)
bind 0.0.0.0

# Protected mode (disable in trusted networks)
protected-mode no

# Port
port 6379

# TCP backlog
tcp-backlog 511

# Timeout (0 = no timeout)
timeout 0

# TCP keepalive
tcp-keepalive 300

# =============================================================================
# GENERAL
# =============================================================================

# Daemonize (no when using Docker)
daemonize no

# Supervised (systemd/upstart/auto/no)
supervised no

# PID file
pidfile /var/run/redis/redis-server.pid

# Log level (debug, verbose, notice, warning)
loglevel notice

# Log file (empty for stdout)
logfile ""

# Databases
databases 16

# Always show logo
always-show-logo no

# =============================================================================
# SNAPSHOTTING (RDB)
# =============================================================================

# Save points (seconds changes)
save 900 1
save 300 10
save 60 10000

# Stop writes on bgsave error
stop-writes-on-bgsave-error yes

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# Sanitize dump payloads
sanitize-dump-payload no

# RDB filename
dbfilename dump.rdb

# Remove RDB files used by replication
rdb-del-sync-files no

# Working directory
dir /data

# =============================================================================
# REPLICATION
# =============================================================================

# Replica read-only
replica-read-only yes

# Replication SYNC strategy
repl-diskless-sync yes
repl-diskless-sync-delay 5
repl-diskless-sync-max-replicas 0
repl-diskless-load disabled

# Replication ping period
repl-ping-replica-period 10

# Replication timeout
repl-timeout 60

# Disable TCP_NODELAY on socket
repl-disable-tcp-nodelay no

# Backlog size
repl-backlog-size 1mb

# Backlog TTL
repl-backlog-ttl 3600

# Replica priority (lower = preferred for promotion)
replica-priority 100

# =============================================================================
# SECURITY
# =============================================================================

# Require password (use env variable or secrets manager in production)
# requirepass your_redis_password_here

# ACL log max length
acllog-max-len 128

# =============================================================================
# CLIENTS
# =============================================================================

# Max clients
maxclients 10000

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================

# Max memory (adjust based on available RAM)
maxmemory 2gb

# Memory policy
maxmemory-policy allkeys-lru

# Memory samples for eviction
maxmemory-samples 5

# Replica ignore maxmemory
replica-ignore-maxmemory yes

# Active expire effort (1=light, 10=aggressive)
active-expire-effort 1

# =============================================================================
# LAZY FREEING
# =============================================================================

lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
lazyfree-lazy-user-del no
lazyfree-lazy-user-flush no

# =============================================================================
# THREADED I/O
# =============================================================================

# I/O threads (0 = disabled)
io-threads 4
io-threads-do-reads no

# =============================================================================
# KERNEL OOM CONTROL
# =============================================================================

oom-score-adj no
oom-score-adj-values 0 200 800

# =============================================================================
# KERNEL TRANSPARENT HUGE PAGES
# =============================================================================

disable-thp yes

# =============================================================================
# APPEND ONLY MODE (AOF)
# =============================================================================

# Enable AOF
appendonly yes

# AOF filename
appendfilename "appendonly.aof"
appenddirname "appendonlydir"

# AOF fsync policy (always/everysec/no)
appendfsync everysec

# No fsync on rewrite
no-appendfsync-on-rewrite no

# Auto-rewrite thresholds
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Load truncated AOF
aof-load-truncated yes

# Enable RDB preamble in AOF
aof-use-rdb-preamble yes

# AOF timestamp
aof-timestamp-enabled no

# =============================================================================
# SLOW LOG
# =============================================================================

# Slower than (microseconds)
slowlog-log-slower-than 10000

# Max length
slowlog-max-len 128

# =============================================================================
# LATENCY MONITOR
# =============================================================================

latency-monitor-threshold 0

# =============================================================================
# EVENT NOTIFICATION
# =============================================================================

# Keyspace notifications (K=keyspace, E=keyevent, g=generic, $=string, etc.)
notify-keyspace-events "KEA"

# =============================================================================
# ADVANCED CONFIG
# =============================================================================

# Hash
hash-max-listpack-entries 512
hash-max-listpack-value 64

# List
list-max-listpack-size -2
list-compress-depth 0

# Set
set-max-intset-entries 512
set-max-listpack-entries 128
set-max-listpack-value 64

# Sorted Set
zset-max-listpack-entries 128
zset-max-listpack-value 64

# HyperLogLog
hll-sparse-max-bytes 3000

# Stream
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing
activerehashing yes

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Hz
hz 10

# Dynamic hz
dynamic-hz yes

# AOF rewrite incremental fsync
aof-rewrite-incremental-fsync yes

# RDB save incremental fsync
rdb-save-incremental-fsync yes

# =============================================================================
# SIEM-SOAR SPECIFIC KEYS & NAMESPACES
# =============================================================================
# Key naming conventions:
#   session:{session_id}          - User sessions
#   cache:tenant:{tenant_id}:*    - Tenant-specific cache
#   rate_limit:{api_key}          - API rate limiting
#   pubsub:alerts:{tenant_id}     - Real-time alert notifications
#   pubsub:events:{tenant_id}     - Event streaming
#   queue:playbook:{playbook_id}  - Playbook execution queue
#   lock:{resource}               - Distributed locks
#   counter:*                     - Various counters
# =============================================================================
