# Gitleaks Configuration for SIEM/SOAR Platform
# Detects secrets, API keys, and credentials in code

title = "SIEM/SOAR Gitleaks Configuration"

# Global allowlist
[allowlist]
description = "Global allowlist"
paths = [
    '''(.*)?\.lock$''',
    '''(.*)?go\.sum$''',
    '''(.*)?package-lock\.json$''',
    '''(.*)?pnpm-lock\.yaml$''',
    '''(.*)?yarn\.lock$''',
    '''(.*)?\.git/.*''',
    '''vendor/.*''',
    '''node_modules/.*''',
    '''\.venv/.*''',
    '''__pycache__/.*''',
    '''\.pytest_cache/.*''',
    '''tests/fixtures/.*''',
    '''docs/.*\.md$''',
    '''.*_test\.go$''',
    '''test_.*\.py$''',
]

# ============================================================
# API Keys and Tokens
# ============================================================

[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey|api_token)[\s]*[:=][\s]*['\"]?([a-zA-Z0-9_\-]{20,60})['\"]?'''
secretGroup = 2
tags = ["api-key"]

[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''AKIA[0-9A-Z]{16}'''
tags = ["aws", "key"]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)aws[_-]?secret[_-]?access[_-]?key[\s]*[:=][\s]*['\"]?([a-zA-Z0-9/+=]{40})['\"]?'''
secretGroup = 1
tags = ["aws", "secret"]

[[rules]]
id = "gcp-service-account"
description = "GCP Service Account Key"
regex = '''(?i)(\"type\":\s*\"service_account\")'''
tags = ["gcp", "service-account"]

[[rules]]
id = "gcp-api-key"
description = "GCP API Key"
regex = '''AIza[0-9A-Za-z_-]{35}'''
tags = ["gcp", "key"]

[[rules]]
id = "azure-subscription-key"
description = "Azure Subscription Key"
regex = '''(?i)azure[_-]?(subscription|storage|cosmos)?[_-]?key[\s]*[:=][\s]*['\"]?([a-zA-Z0-9+/=]{44,})['\"]?'''
secretGroup = 2
tags = ["azure", "key"]

# ============================================================
# Authentication Credentials
# ============================================================

[[rules]]
id = "generic-password"
description = "Generic Password"
regex = '''(?i)(password|passwd|pwd)[\s]*[:=][\s]*['\"]?([a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':\"\\|,.<>\/?]{8,})['\"]?'''
secretGroup = 2
tags = ["password"]
[rules.allowlist]
regexes = [
    '''password\s*[:=]\s*['\"]?\$\{.*\}['\"]?''',  # Environment variables
    '''password\s*[:=]\s*['\"]?<.*>['\"]?''',       # Placeholder values
    '''password\s*[:=]\s*['\"]?changeme['\"]?''',   # Example values
    '''password\s*[:=]\s*['\"]?example['\"]?''',
    '''password\s*[:=]\s*['\"]?test['\"]?''',
]

[[rules]]
id = "private-key"
description = "Private Key"
regex = '''-----BEGIN (?:RSA|DSA|EC|OPENSSH|PGP)? ?PRIVATE KEY(?: BLOCK)?-----'''
tags = ["key", "private"]

[[rules]]
id = "ssh-private-key"
description = "SSH Private Key"
regex = '''-----BEGIN OPENSSH PRIVATE KEY-----'''
tags = ["ssh", "key", "private"]

# ============================================================
# OAuth and JWT
# ============================================================

[[rules]]
id = "oauth-client-secret"
description = "OAuth Client Secret"
regex = '''(?i)(client[_-]?secret|oauth[_-]?secret)[\s]*[:=][\s]*['\"]?([a-zA-Z0-9_\-]{20,})['\"]?'''
secretGroup = 2
tags = ["oauth", "secret"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*'''
tags = ["jwt", "token"]
[rules.allowlist]
description = "Allow test JWT tokens"
regexes = [
    '''eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0\..*''',  # Test tokens with none algorithm
]

# ============================================================
# Database Credentials
# ============================================================

[[rules]]
id = "postgres-connection-string"
description = "PostgreSQL Connection String"
regex = '''postgres(?:ql)?:\/\/[^:]+:[^@]+@[^\/]+\/\w+'''
tags = ["database", "postgres"]

[[rules]]
id = "mysql-connection-string"
description = "MySQL Connection String"
regex = '''mysql:\/\/[^:]+:[^@]+@[^\/]+\/\w+'''
tags = ["database", "mysql"]

[[rules]]
id = "mongodb-connection-string"
description = "MongoDB Connection String"
regex = '''mongodb(?:\+srv)?:\/\/[^:]+:[^@]+@[^\/]+'''
tags = ["database", "mongodb"]

[[rules]]
id = "redis-connection-string"
description = "Redis Connection String"
regex = '''redis:\/\/[^:]*:[^@]+@[^\/]+'''
tags = ["database", "redis"]

[[rules]]
id = "clickhouse-connection-string"
description = "ClickHouse Connection String"
regex = '''(?i)clickhouse:\/\/[^:]+:[^@]+@[^\/]+'''
tags = ["database", "clickhouse"]

# ============================================================
# Third-Party Services
# ============================================================

[[rules]]
id = "slack-webhook"
description = "Slack Webhook URL"
regex = '''https://hooks\.slack\.com/services/T[a-zA-Z0-9_]+/B[a-zA-Z0-9_]+/[a-zA-Z0-9_]+'''
tags = ["slack", "webhook"]

[[rules]]
id = "slack-token"
description = "Slack Token"
regex = '''xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24}'''
tags = ["slack", "token"]

[[rules]]
id = "github-token"
description = "GitHub Token"
regex = '''gh[ps]_[a-zA-Z0-9]{36}'''
tags = ["github", "token"]

[[rules]]
id = "github-fine-grained-token"
description = "GitHub Fine-Grained Token"
regex = '''github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59}'''
tags = ["github", "token"]

[[rules]]
id = "gitlab-token"
description = "GitLab Token"
regex = '''glpat-[a-zA-Z0-9\-_]{20}'''
tags = ["gitlab", "token"]

[[rules]]
id = "openai-api-key"
description = "OpenAI API Key"
regex = '''sk-[a-zA-Z0-9]{48}'''
tags = ["openai", "ai", "key"]

[[rules]]
id = "anthropic-api-key"
description = "Anthropic API Key"
regex = '''sk-ant-[a-zA-Z0-9\-_]{93}'''
tags = ["anthropic", "ai", "key"]

[[rules]]
id = "sendgrid-api-key"
description = "SendGrid API Key"
regex = '''SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}'''
tags = ["sendgrid", "email", "key"]

[[rules]]
id = "twilio-auth-token"
description = "Twilio Auth Token"
regex = '''(?i)twilio[_-]?auth[_-]?token[\s]*[:=][\s]*['\"]?([a-f0-9]{32})['\"]?'''
secretGroup = 1
tags = ["twilio", "token"]

[[rules]]
id = "datadog-api-key"
description = "Datadog API Key"
regex = '''(?i)datadog[_-]?api[_-]?key[\s]*[:=][\s]*['\"]?([a-f0-9]{32})['\"]?'''
secretGroup = 1
tags = ["datadog", "key"]

[[rules]]
id = "pagerduty-api-key"
description = "PagerDuty API Key"
regex = '''(?i)pagerduty[_-]?api[_-]?key[\s]*[:=][\s]*['\"]?([a-zA-Z0-9+/=]{20})['\"]?'''
secretGroup = 1
tags = ["pagerduty", "key"]

# ============================================================
# Encryption Keys
# ============================================================

[[rules]]
id = "encryption-key"
description = "Encryption Key"
regex = '''(?i)(encryption[_-]?key|secret[_-]?key|aes[_-]?key)[\s]*[:=][\s]*['\"]?([a-fA-F0-9]{32,64})['\"]?'''
secretGroup = 2
tags = ["encryption", "key"]

[[rules]]
id = "hmac-secret"
description = "HMAC Secret"
regex = '''(?i)hmac[_-]?secret[\s]*[:=][\s]*['\"]?([a-zA-Z0-9+/=]{32,})['\"]?'''
secretGroup = 1
tags = ["hmac", "secret"]

# ============================================================
# Platform-Specific Rules
# ============================================================

[[rules]]
id = "siem-api-key"
description = "SIEM Platform API Key"
regex = '''(?i)siem[_-]?api[_-]?key[\s]*[:=][\s]*['\"]?([a-zA-Z0-9_\-]{32,})['\"]?'''
secretGroup = 1
tags = ["siem", "platform", "key"]

[[rules]]
id = "soar-connector-secret"
description = "SOAR Connector Secret"
regex = '''(?i)connector[_-]?secret[\s]*[:=][\s]*['\"]?([a-zA-Z0-9_\-]{20,})['\"]?'''
secretGroup = 1
tags = ["soar", "connector", "secret"]

# ============================================================
# File-Specific Allowlists
# ============================================================

[rules.allowlist]
paths = [
    '''\.example$''',
    '''\.sample$''',
    '''\.template$''',
    '''docker-compose\.override\.yml$''',
]
